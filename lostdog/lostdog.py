from selenium import webdriver
from selenium.webdriver.common.keys import Keys 
from selenium.webdriver.firefox.options import Options
import webbrowser
import requests
from bs4 import BeautifulSoup

def makeDict():
    # Got HTML list of dog breeds from site. Following code creates a dictionary mapping a breed to its breedId
    toparse = '"">All Breeds</option><option value="101">Abruzzese Mastiff</option><option value="696">Affenpinscher</option><option value="621">Afghan Hound</option><option value="95">Aidi</option><option value="235393">Ainu</option><option value="10">Akbash</option><option value="650">Akita</option><option value="11">Alano Espanol</option><option value="12">Alapaha Blue Blood Bulldog</option><option value="13">Alaskan Husky</option><option value="14">Alaskan Klee Kai</option><option value="651">Alaskan Malamute</option><option value="15">Alopekis</option><option value="16">Alpine Dachsbracke</option><option value="17">American Bandogge Mastiff</option><option value="18">American Blue Gascon Hound</option><option value="791">American Blue Heeler</option><option value="19">American Bullnese</option><option value="780">American Eskimo</option><option value="20">American Indian Dog</option><option value="21">American Lo-Sze Pugg</option><option value="22">American White Shepherd</option><option value="796">Anatolian Shepherd</option><option value="23">Appenzeller Sennenhunde</option><option value="24">Argentine Dogo</option><option value="93">Armant</option><option value="733">Australian Cattle Dog</option><option value="754">Australian Kelpie</option><option value="806">Australian Koolie</option><option value="734">Australian Shepherd</option><option value="235394">Australian Shepherd, Miniature</option><option value="817">Austrian Pinscher</option><option value="25">Azawakh</option><option value="235395">Azores Cattle Dog</option><option value="110">Banter Bulldogge</option><option value="354">Barbet</option><option value="622">Basenji</option><option value="623">Basset Hound</option><option value="624">Beagle</option><option value="735">Bearded Collie</option><option value="26">Beauceron</option><option value="738">Belgian Laekenois</option><option value="739">Belgian Malinois</option><option value="736">Belgian Sheepdog</option><option value="740">Belgian Tervuren</option><option value="27">Bergamasco</option><option value="741">Berger des Pyrenees</option><option value="652">Bernese Mountain Dog</option><option value="716">Bichon Frise</option><option value="625">Bloodhound</option><option value="28">Boerboel</option><option value="3">Bolognese</option><option value="676">Border Collie</option><option value="626">Borzoi</option><option value="98">Bouvier des Ardennes</option><option value="742">Bouvier des Flandres</option><option value="653">Boxer</option><option value="29">Bracco Italiano</option><option value="590">Braque Francais Gascogne</option><option value="591">Braque Francais Pyrenees</option><option value="743">Briard</option><option value="609">Brittany</option><option value="235396">Brittany, French</option><option value="718">Bulldog</option><option value="85">Bulldog, American</option><option value="795">Bulldog, English</option><option value="722">Bulldog, French</option><option value="235397">Bulldog, Victorian</option><option value="654">Bullmastiff</option><option value="97">Cambodian Razorback Dog</option><option value="655">Canaan</option><option value="656">Canadian Eskimo</option><option value="776">Cane Corso</option><option value="102">Cane Di Oropa</option><option value="103">Cane Toccatore</option><option value="83">Carolina Dog</option><option value="816">Carpathian Shepherd Dog</option><option value="107">Castro Laboreiro Dog</option><option value="801">Catahoula Leopard dog</option><option value="30">Caucasian Mountain Dog</option><option value="31">Central Asian Outcharka Shepherd</option><option value="32">Central Asian Shepherd Dog</option><option value="698">Chihuahua, Long Coat</option><option value="699">Chihuahua, Short Coat</option><option value="700">Chinese Crested</option><option value="235398">Chinese Foo</option><option value="719">Chinese Shar-Pei</option><option value="33">Chinook</option><option value="720">Chow Chow</option><option value="818">CimarrÃ³n Uruguayo</option><option value="235399">Cirneco dell Etna</option><option value="744">Collie, Rough</option><option value="745">Collie, Smooth</option><option value="627">Coonhound</option><option value="34">Coonhound, American English</option><option value="35">Coonhound, Black and Tan</option><option value="782">Coonhound, Bluetick</option><option value="36">Coonhound, Redbone</option><option value="790">Coonhound, Treeing Walker</option><option value="794">Coton de Tulear</option><option value="815">Croatian Sheepdog</option><option value="82">Cur, Black-Mouth</option><option value="81">Cur, Mountain</option><option value="37">Czechoslovakian Wolfdog</option><option value="628">Dachshund, Miniature Long Haired</option><option value="629">Dachshund, Miniature Smooth Haired</option><option value="633">Dachshund, Miniature Wire Haired</option><option value="631">Dachshund, Standard Long Haired</option><option value="630">Dachshund, Standard Smooth Haired</option><option value="632">Dachshund, Standard Wire Haired</option><option value="721">Dalmatian</option><option value="96">Damchi</option><option value="235401">Danish Broholmer</option><option value="634">Deerhound, Scottish</option><option value="657">Doberman Pinscher</option><option value="778">Dogue de Bordeaux</option><option value="355">Dosa Inu</option><option value="635">Drever</option><option value="758">Dunker Hound</option><option value="353">Dutch Sheepdog</option><option value="235402">Dutch Shepherd</option><option value="104">Dutch Smoushond</option><option value="781">English Mastiff</option><option value="813">English Shepherd</option><option value="38">Entlebucher Mountain Dog</option><option value="759">Estrela Mountain Dog</option><option value="760">Eurasier</option><option value="814">Feist</option><option value="761">Fila Brasileiro</option><option value="39">Finnish Lapphund</option><option value="636">Finnish Spitz</option><option value="637">Foxhound, American</option><option value="638">Foxhound, English</option><option value="792">German Pinscher</option><option value="746">German Shepherd</option><option value="747">German Shepherd, King</option><option value="762">German Spitz</option><option value="658">Great Dane</option><option value="659">Great Pyrenees</option><option value="763">Greater Swiss Mountain Dog</option><option value="40">Greenland Dog</option><option value="639">Greyhound</option><option value="41">Griffon Vendeen, Grand Basset</option><option value="640">Griffon Vendeen, Petit Basset</option><option value="702">Griffon, Brussels</option><option value="592">Griffon, Wirehaired Pointing</option><option value="737">Groenendael</option><option value="106">Haldenstoever</option><option value="641">Harrier</option><option value="787">Havanese</option><option value="6">Hound</option><option value="352">Hovawart</option><option value="811">Hygenhund</option><option value="642">Ibizan Hound</option><option value="785">Icelandic Sheepdog</option><option value="643">Irish Wolfhound</option><option value="703">Italian Greyhound</option><option value="235403">Italiano Volpino</option><option value="704">Japanese Chin</option><option value="723">Japanese Spitz</option><option value="42">Kai Ken</option><option value="235404">Kangal</option><option value="99">Karakachan Dog</option><option value="43">Karelian Bear Dog</option><option value="724">Keeshond</option><option value="100">Kerry Beagle</option><option value="660">Komondor</option><option value="44">Kooikerhondje</option><option value="804">Korean Jindo</option><option value="820">Kromfohrlander, Smooth Coat</option><option value="821">Kromfohrlander, Wire Haired</option><option value="661">Kuvasz</option><option value="235405">Lacy</option><option value="45">Lagotto Romagnolo</option><option value="767">Lancashire Heeler</option><option value="768">Landseer</option><option value="662">Leonberger</option><option value="725">Lhasa Apso</option><option value="46">Lowchen</option><option value="705">Maltese</option><option value="235406">Maremma Sheepdog</option><option value="663">Mastiff</option><option value="84">McNab Herding Dog</option><option value="356">Mee Kyun Dosa</option><option value="707">Mexican Hairless</option><option value="710">Miniature Pinscher</option><option value="757">Mix</option><option value="111">Mixed Breed, Large (over 44 lbs fully grown)</option><option value="112">Mixed Breed, Medium (up to 44 lbs fully grown)</option><option value="113">Mixed Breed, Small (under 24 lbs fully grown)</option><option value="47">Mudi</option><option value="769">Munsterlander, Large </option><option value="784">Munsterlander,Small</option><option value="770">Neapolitan Mastiff</option><option value="2">New Guinea Singing Dog</option><option value="664">Newfoundland</option><option value="48">Norbottenspets</option><option value="749">Norwegian Buhund</option><option value="644">Norwegian Elkhound</option><option value="49">Norwegian Lundehund</option><option value="750">Old English Sheepdog</option><option value="235407">Olde English Bulldogge</option><option value="645">Otterhound</option><option value="708">Papillon</option><option value="709">Pekingese</option><option value="109">Perdiguero Gallego</option><option value="50">Perro de Presa Canario</option><option value="51">Peruvian Inca Orchid</option><option value="646">Pharaoh Hound</option><option value="789">Picardy Sheepdog</option><option value="52">Plott Hound</option><option value="94">Podenco Canario</option><option value="108">Podenco Gallego</option><option value="593">Pointer</option><option value="793">Pointer, German Shorthaired</option><option value="596">Pointer, German Wirehaired</option><option value="357">Polish Lowland Sheepdog</option><option value="711">Pomeranian</option><option value="726">Poodle, Miniature</option><option value="727">Poodle, Standard</option><option value="712">Poodle, Toy</option><option value="351">Poong-San Dog</option><option value="92">Portugese Sheepdog</option><option value="53">Portuguese Podengo</option><option value="665">Portuguese Water Dog</option><option value="597">Pudelpointer</option><option value="713">Pug</option><option value="748">Puli</option><option value="54">Pumi</option><option value="55">Pyrenean Shepherd</option><option value="56">Rafeiro do Alentejo</option><option value="8">Retriever</option><option value="598">Retriever, Chesapeake Bay</option><option value="599">Retriever, Curly Coated</option><option value="600">Retriever, Flat-Coated</option><option value="601">Retriever, Golden</option><option value="602">Retriever, Labrador</option><option value="603">Retriever, Nova Scotia Duck Tolling</option><option value="647">Rhodesian Ridgeback</option><option value="666">Rottweiler</option><option value="235408">Royal Bahamian Potcake</option><option value="105">Saarloos Wolfdog</option><option value="671">Saint Bernard</option><option value="648">Saluki</option><option value="667">Samoyed</option><option value="728">Schipperke</option><option value="668">Schnauzer, Giant</option><option value="688">Schnauzer, Miniature</option><option value="669">Schnauzer, Standard</option><option value="812">Schweizer Laufhund (Swiss Hound)</option><option value="604">Setter, English</option><option value="605">Setter, Gordon</option><option value="606">Setter, Irish</option><option value="764">Setter, Irish Red and White</option><option value="7">Shepherd</option><option value="751">Shetland Sheepdog</option><option value="729">Shiba Inu</option><option value="730">Shih Tzu</option><option value="235410">Shiloh Shepherd</option><option value="670">Siberian Husky</option><option value="91">Silken Windhound</option><option value="57">Sloughi</option><option value="235411">South Russian Ovcharkas</option><option value="9">Spaniel</option><option value="607">Spaniel, American Cocker</option><option value="608">Spaniel, American Water</option><option value="58">Spaniel, Boykin</option><option value="697">Spaniel, Cavalier King Charles</option><option value="610">Spaniel, Clumber</option><option value="611">Spaniel, English Cocker</option><option value="612">Spaniel, English Springer</option><option value="701">Spaniel, English Toy</option><option value="613">Spaniel, Field</option><option value="614">Spaniel, French</option><option value="615">Spaniel, Irish Water</option><option value="616">Spaniel, Sussex</option><option value="731">Spaniel, Tibetan</option><option value="617">Spaniel, Welsh Springer</option><option value="805">Spanish Water Dog</option><option value="1">Spinone Italiano</option><option value="59">Stabyhoun</option><option value="772">Swedish Elkhound</option><option value="803">Swedish Vallhund</option><option value="773">Tahitian Bear Dog</option><option value="5">Terrier</option><option value="60">Terrier, Abyssinian Sand</option><option value="672">Terrier, Airedale</option><option value="61">Terrier, American Crested Sand</option><option value="808">Terrier, American Hairless</option><option value="87">Terrier, American Pit Bull</option><option value="673">Terrier, American Staffordshire</option><option value="674">Terrier, Australian</option><option value="675">Terrier, Bedlington</option><option value="62">Terrier, Black Russian</option><option value="777">Terrier, Border</option><option value="717">Terrier, Boston</option><option value="819">Terrier, Brazilian</option><option value="677">Terrier, Bull</option><option value="678">Terrier, Cairn</option><option value="63">Terrier, Cesky</option><option value="679">Terrier, Dandie Dinmont</option><option value="799">Terrier, English Staffordshire</option><option value="680">Terrier, Fox, Smooth</option><option value="80">Terrier, Fox, Toy</option><option value="681">Terrier, Fox, Wire</option><option value="64">Terrier, Glen of Imaal</option><option value="682">Terrier, Irish</option><option value="765">Terrier, Jack Russell</option><option value="766">Terrier, Japanese</option><option value="683">Terrier, Kerry Blue</option><option value="684">Terrier, Lakeland</option><option value="685">Terrier, Manchester</option><option value="65">Terrier, Miniature Bull</option><option value="686">Terrier, Norfolk</option><option value="687">Terrier, Norwich</option><option value="66">Terrier, Parson Russell</option><option value="86">Terrier, Patterdale</option><option value="771">Terrier, Pit Bull</option><option value="798">Terrier, Rat</option><option value="809">Terrier, Russell</option><option value="689">Terrier, Scottish</option><option value="690">Terrier, Sealyham</option><option value="714">Terrier, Silky</option><option value="691">Terrier, Skye</option><option value="692">Terrier, Soft Coated Wheaten</option><option value="693">Terrier, Staffordshire Bull</option><option value="732">Terrier, Tibetan</option><option value="694">Terrier, Welsh</option><option value="695">Terrier, West Highland White</option><option value="715">Terrier, Yorkshire</option><option value="67">Thai Ridgeback</option><option value="774">Tibetan Mastiff</option><option value="68">Tosa</option><option value="69">Treeing Tennessee Brindle</option><option value="618">Vizsla, Smooth Haired</option><option value="619">Vizsla, Wire Haired</option><option value="620">Weimaraner</option><option value="752">Welsh Corgi, Cardigan</option><option value="753">Welsh Corgi, Pembroke</option><option value="649">Whippet</option><option value="810">White Swiss Shepherd (Berger Blanc Suisse)</option><option value="70">Xoloitzcuintli'
    semiparsed = toparse.split('</option><option value=')
    #print( semiparsed )
    removedquotes = []
    for entry in semiparsed:
        removedquotes.append(entry.replace('"', ''))
    #print( removedquotes )
    dogtonum = {}
    for entry in removedquotes:
        splitentry = entry.split('>')
        # Key is breed name, value is corresponding number
        dogtonum[splitentry[1]] = splitentry[0]
    return dogtonum
 
def getBreedIndex(dogtonum, breed):
    matching_dogs = list()
    if breed.title() in dogtonum:
        return [dogtonum[breed]]
    
    breed_keywords = breed.split()
    #print(breed_keywords)
    for keyword in breed_keywords:
        if keyword != "dog":
            for dog in dogtonum:
                #print(dog)
                if keyword.lower() in dog.lower():
                    #print("found dog! {:s}".format(keyword))
                    matching_dogs.append(dogtonum[dog]) 
    return matching_dogs

def findLostDog(breed, location):
    #https://www.petango.com/pet_search_results?speciesId=1&breedId=0&location=12180&distance=50
    URL = "https://www.petango.com/Lost-Pet-Search-Results"
    distance = 500
    dogtonum = makeDict()
    breedList = getBreedIndex(dogtonum, breed)
    options = Options()
    options.add_argument('--headless')
    browser = webdriver.Firefox(options=options)
    animal_profiles = list()
    for i in range(len(breedList)):
        breedId = breedList[i]
        PARAMS = {'speciesId' : "1", 'breedId' : breedId, 'location' : location, 'distance' : str(distance)}
        response = requests.get(url = URL, params = PARAMS)
        fullURL = URL + '?speciesId=1&breedId=' + str(breedId) + '&location=' + str(location) + '&distance=' + str(distance) + '&gender=&size=&color=&mustHavePhoto=1&la=1'
        browser.get(fullURL)
        soup = BeautifulSoup(browser.page_source, "html.parser")
        #print(soup)

        for tag in soup.findAll(class_='animal-template'):
            #animal_profiles.append(tag)
            #print(tag)
            profile = dict()
            animal_image_tag = tag.find(attrs={"class": "animal-image"})
            animal_image = animal_image_tag['style']
            a_im_start = animal_image.find('url("') + 5
            a_im_end = animal_image.find('")')
            animal_image_url = animal_image[a_im_start:a_im_end]
            animal_name = tag.find(attrs={"data-bind": "text: name"}).string
            animal_dist = tag.find(attrs={"data-bind": "text: distance"}).string
            animal_gender = tag.find(attrs={"data-bind": "text: gender"}).string
            animal_breed = tag.find(attrs={"data-bind": "text: breed"}).string
            animal_link = tag.find(attrs={"data-bind": "attr: { href: url}"})['href']
            profile['image'] = animal_image_url
            profile['name'] = animal_name
            profile['distance'] = animal_dist
            profile['gender'] = animal_gender
            profile['breed'] = animal_breed
            profile['link'] = str(animal_link)
            animal_profiles.append(profile)
    browser.quit()
    return animal_profiles
